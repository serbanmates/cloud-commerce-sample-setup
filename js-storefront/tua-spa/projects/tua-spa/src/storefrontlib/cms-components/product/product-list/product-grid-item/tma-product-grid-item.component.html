<a
  [routerLink]="{ cxRoute: 'product', params: product } | cxUrl"
  class="cx-product-image-container"
>
  <cx-media
    class="cx-product-image"
    [container]="product.images?.PRIMARY"
    format="product"
    [alt]="product.summary"
  >
  </cx-media>
</a>
<a
  [routerLink]="{ cxRoute: 'product', params: product } | cxUrl"
  class="cx-product-name"
  [innerHTML]="product.nameHtml"
></a>
<div class="cx-product-rating">
  <cx-star-rating
    *ngIf="product.averageRating"
    [rating]="product?.averageRating"
    [disabled]="true"
  ></cx-star-rating>
  <div *ngIf="!product.averageRating">
    {{ 'productDetails.noReviews' | cxTranslate }}
  </div>
</div>

<ng-container *ngIf="!(productSpecificationForAverageCost || productSpecificationForViewDetails)">
  <div class="cx-product-price-container">
    <div class="cx-product-price" aria-label="Product price">
      <ng-container *ngIf="product.price.formattedValue; else compositePrice">
        {{ product.price?.formattedValue }}
      </ng-container>
    </div>
  </div>
  <ng-template #compositePrice>
    <cx-price-display [price]="product.productOfferingPrice[0]" [discounts]="priceService.getDiscountPricesForSPO(product)"></cx-price-display>
  </ng-template>
</ng-container>

<ng-container
  *ngIf="productSpecificationForAverageCost && consumptionComponent">
  <ng-container *ngIf="detailedProduct$ | async as detailedProduct else loading">
    <ng-container *ngIf="priceService.getUsageUnits(detailedProduct).length < 2; else showBasePrice">

      <br/>

      <ng-container *ngIf="currency$ | async as currency">
        <div class="row d-flex justify-content-center">{{'productDetails.averageCost' | cxTranslate}}*</div>
        <div class="row d-flex justify-content-center">
          <div #averageCostPerMonth class="cx-size-large cx-bold">
            {{ getAverageCostPerMonth(detailedProduct, currency) }}
          </div>
          <div>&nbsp;/ {{'productDetails.month' | cxTranslate}}</div>
        </div>
        <div class="row cx-size-small d-flex justify-content-center">
          (
          <div #averageCostPerYear>
            {{ getAverageCostPerYear(detailedProduct, currency) }}
          </div>
          / {{'productDetails.year' | cxTranslate}}*)
        </div>
      </ng-container>
    </ng-container>
    <ng-template #showBasePrice>
      <div class="d-flex justify-content-center">
        <div class="text-warning text-center cx-size-small">
          {{ 'productDetails.costEstimationWarningMessage' | cxTranslate }}
        </div>
      </div>
      <div class="row d-flex justify-content-center">
        <div class="cx-product-price cx-bold" aria-label="Product price">
          {{ product.price?.formattedValue }}
        </div>
      </div>
    </ng-template>
  </ng-container>
</ng-container>

<ng-container *ngIf="productSpecificationForViewDetails && consumptionComponent">
  <ng-container *ngIf="detailedProduct$ | async as detailedProduct else loading">
    <ng-container *ngIf="priceService.getHighestPriorityPriceForSPO(detailedProduct) as highestPriorityPrice">
      <div class="row d-flex justify-content-center">
        <button (click)="changeShowDetailedPrices()" class="btn btn-link">
          {{'productList.viewDetailedPrices' | cxTranslate}}
        </button>
      </div>

      <!-- 'View Details' button -->
      <button
        [routerLink]="{ cxRoute: 'product', params: product } | cxUrl"
        class="btn btn-primary btn-block"
        type="button"
      >
        {{'productList.viewDetails' | cxTranslate}}
      </button>

      <div *ngIf="showDetailedPrices" class="row border rounded">
        <div (click)="changeShowDetailedPrices()" class="col-md-12 d-flex justify-content-end close">&times;</div>
        <div class="col-md-12">
          <cx-price-display [price]="highestPriorityPrice" [discounts]="priceService.getDiscountPricesForSPO(product)"></cx-price-display>
        </div>
      </div>
    </ng-container>
  </ng-container>
</ng-container>

<ng-container *ngIf="!productSpecificationForViewDetails">
  <ng-container
    *ngIf="getChecklistActions(product.code) | async as checklistActions"
  >
    <ng-container
      *ngIf="checklistActions.length > 0; else noChecklist"
    >
      <button
        [routerLink]="{ cxRoute: 'product', params: product } | cxUrl"
        class="btn btn-primary btn-block"
        type="button"
      >
        {{ 'productList.seeDetails' | cxTranslate }}
      </button>
    </ng-container>
  </ng-container>
  <ng-template #noChecklist>
    <ng-template [cxOutlet]="ProductListOutlets.ITEM_ACTIONS">
      <ng-container cxInnerComponentsHost></ng-container>
    </ng-template>
  </ng-template>
</ng-container>

<ng-template #loading>
  <div class="cx-spinner">
    <cx-spinner></cx-spinner>
  </div>
</ng-template>
