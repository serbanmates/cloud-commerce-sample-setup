<div class="d-flex align-items-center mt-4 col-12 row">
  <h4 class="font-weight-bolder m-0 pl-0 col-8">
    {{ 'purchaseReason.reasonForPurchase' | cxTranslate }}
  </h4>
  <button
    *ngIf="!isEdit && this.showEdit"
    type="button" [attr.aria-label]="'checkList.reasonForPurchase.selectReasonForPurchase' | cxTranslate"
    class="btn btn-tertiary font-label pr-0 col-4"
    (click)="displayReasonForPurchaseForm()"
  >
    {{ 'common.edit' | cxTranslate }}
  </button>
</div>

<ng-container *ngIf="isEdit">
  <ng-container *ngIf="checklistAction$ | async as checklistAction">
    <ng-container *ngIf="!isReadOnly">
      <ng-container [ngSwitch]="selectedReasonPurchase">
        <!-- Contract Start Date -->
        <ng-container *ngIf="hasChecklistActionOfType(checklistAction, checklistActionType.CONTRACT_START_DATE)">
          <div class="form-check">
            <input class="form-check-input" type="radio" id="move" name="purchase-reason-{{entryNumber}}"
                   value="move"
                   (change)="onMoveInChecked()"
                   [checked]="selectedReasonPurchase === constants.REASON_FOR_PURCHASE.MOVE">
            <label [ngClass]="compact ? 'readonly form-check-label ' : 'form-check-label'"
                   for="move">{{ 'purchaseReason.move' |cxTranslate }}</label><br>
          </div>
        </ng-container>
        <ng-container *ngSwitchCase="constants.REASON_FOR_PURCHASE.MOVE">
          <ng-container *ngIf="hasChecklistActionOfType(checklistAction, checklistActionType.CONTRACT_START_DATE)">
            <div *ngIf="!isReadOnly">
              <div class="form-group">
                <label [ngClass]="compact ? 'cx-cart-item-label readonly-dark' : 'cx-cart-item-label'"
                       for="contract-start-date">{{ 'purchaseReason.desiredContractStartDate' | cxTranslate}}</label>
                <input class="form-control" id="contract-start-date" type="date" min="{{minDate | date:'yyyy-MM-dd'}}"
                       max="{{maxDate | date:'yyyy-MM-dd'}}" value="{{contractStartDate | date:'yyyy-MM-dd'}}"
                       name="contract-start-date" required="required" (change)="onUpdateContractStartDate($event)"/>
              </div>
            </div>

            <div *ngIf="isReadOnly && contractStartDate">
              <div class="form-inline form-group">
                <label class="readonly"
                       for="contract_start_date_readonly">{{ 'purchaseReason.desiredContractStartDate' | cxTranslate}}:&nbsp;
                </label>
                <label class="readonly-value"
                       id="contract_start_date_readonly">{{contractStartDate | date:'dd/MM/yyyy'}}</label>
              </div>
            </div>
          </ng-container>
        </ng-container>

        <!-- Switch provider -->
        <ng-container *ngIf="hasChecklistActionOfType(checklistAction, checklistActionType.SERVICE_PROVIDER)">
          <div class="form-check">
            <input class="form-check-input" type="radio" id="switchProvider" name="purchase-reason-{{entryNumber}}"
                   value="switchProvider"
                   (change)="onSwitchProviderChecked()"
                   [checked]="selectedReasonPurchase === constants.REASON_FOR_PURCHASE.SWITCH_PROVIDER">
            <label [ngClass]="compact ? 'form-check-label readonly' : 'form-check-label'"
                   for="switchProvider">{{ 'purchaseReason.switchProvider' |cxTranslate }}</label><br>
          </div>
        </ng-container>
        <ng-container *ngSwitchCase="constants.REASON_FOR_PURCHASE.SWITCH_PROVIDER">
          <ng-container *ngIf="hasChecklistActionOfType(checklistAction, checklistActionType.SERVICE_PROVIDER)">
            <div *ngIf="!isReadOnly ">
              <div class="form-group">
                <label [ngClass]="compact ? 'cx-cart-item-label readonly-dark' : 'cx-cart-item-label'"
                       for="desired-change-date">{{ 'purchaseReason.desiredChangeDate' | cxTranslate}}</label>
                <input class="form-control" id="desired-change-date" type="date" min="{{minDate | date:'yyyy-MM-dd'}}"
                       max="{{maxDate | date:'yyyy-MM-dd'}}" value="{{contractStartDate | date:'yyyy-MM-dd'}}"
                       name="desired-change-date" required="required" (change)="onUpdateContractStartDate($event)"/>
              </div>
              <div class="form-group">
                <label [ngClass]="compact ? 'cx-cart-item-label readonly-dark' : 'cx-cart-item-label'"
                       for="current_provider">{{ 'purchaseReason.previousEnergySupplier' | cxTranslate }}</label>
                <input #serviceProviderInput class="form-control" id="current_provider" type="text"
                       name="current_provider"
                       maxlength="50"
                       (keyup)="updateServiceProviderButton($event)"
                       value="{{serviceProvider}}"/>
              </div>
            </div>

            <div *ngIf="isReadOnly">
              <div *ngIf="serviceProvider">
                <div *ngIf="contractStartDate">
                  <div class="form-inline form-group">
                    <label class="readonly"
                           for="change_date_readonly">{{ 'purchaseReason.desiredChangeDate' | cxTranslate}}:&nbsp;
                    </label>
                    <label class="readonly-value"
                           id="change_date_readonly">{{contractStartDate | date:'dd/MM/yyyy'}}</label>
                  </div>
                </div>
                <div class="form-inline form-group">
                  <label class="readonly"
                         for="service_provider_readonly">{{ 'purchaseReason.previousEnergySupplier' | cxTranslate}}:&nbsp;
                  </label>
                  <label class="readonly-value" id="service_provider_readonly">{{serviceProvider}}</label>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>

    <div class="d-flex">
      <button
        class="btn btn-secondary"
        (click)="saveReasonForPurchase()"
      >
        {{ 'common.update' | cxTranslate }}
      </button>

      <button
        class="btn btn-tertiary ml-3"
        (click)="displayReasonForPurchaseForm()"
      >
        {{ 'common.cancel' | cxTranslate }}
      </button>
    </div>

  </ng-container>
</ng-container>

<ng-container *ngIf="!isEdit">
  <ng-container *ngIf="getSelectedReasonPurchase() && isSelectedReasonPurchase">
    <ng-container [ngSwitch]="selectedReasonPurchase">
      <ng-container *ngSwitchCase="constants.REASON_FOR_PURCHASE.MOVE">
        <div class="d-flex flex-column flex-wrap align-items-start justify-content-start">
          <span> {{ 'purchaseReason.move' |cxTranslate }}</span>
          <ng-container *ngIf="contractStartDate">
            <h4 class="title mt-2"> {{ 'purchaseReason.desiredContractStartDate' | cxTranslate}} </h4>
            <span>{{contractStartDate | date: 'dd/MM/yyyy'}}</span>
          </ng-container>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="constants.REASON_FOR_PURCHASE.SWITCH_PROVIDER">
        <div class="d-flex flex-column flex-wrap align-items-start justify-content-start">
          <span> {{ 'purchaseReason.switchProvider' |cxTranslate }}</span>
          <ng-container *ngIf="contractStartDate">
            <h4 class="title mt-2"> {{ 'purchaseReason.desiredChangeDate' | cxTranslate}} </h4>
            <span>{{contractStartDate | date: 'dd/MM/yyyy'}}</span>
          </ng-container>
          <ng-container *ngIf="contractStartDate">
            <h4 class="title mt-2"> {{ 'purchaseReason.previousEnergySupplier' | cxTranslate}} </h4>
            <span>{{serviceProvider}}</span>
          </ng-container>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>
